<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Projects</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="portfolio-page">
    <nav class="top-nav">
        <a href="index.html" class="nav-back">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        <h1 id="portfolio-title" class="nav-title"></h1>
        <div class="nav-right">
            <a href="https://github.com/nssukenkyu-prog/YOUR_REPO_NAME/tree/main/data" target="_blank" class="nav-admin" id="github-edit-link">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right:5px; vertical-align: text-bottom;">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="filter-section" id="filter-section">
            </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        </div>
        <div id="projects-grid" class="projects-grid"></div>
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const currentBot = urlParams.get('bot') || 'yuzu';
        let allProjects = [];
        let categories = [];

        // ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
        const botNames = {
            'yuzu': 'ğŸš´â€â™‚ï¸ Yuzu bot. Projects Portfolio',
            'kedo': 'ğŸ”¥ Kedo bot. Projects Portfolio'
        };
        
        // ã‚¿ã‚¤ãƒˆãƒ«åæ˜ 
        const titleElement = document.getElementById('portfolio-title');
        if (titleElement) {
            titleElement.textContent = botNames[currentBot] || `${currentBot} Portfolio`;
        }
        document.title = botNames[currentBot] || 'Portfolio';

        // GitHubç·¨é›†ãƒªãƒ³ã‚¯ã®èª¿æ•´ï¼ˆãƒªãƒã‚¸ãƒˆãƒªURLãŒç¢ºå®šã—ãŸã‚‰æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼‰
        // ã“ã“ã§ã¯ bot ã«ã‚ˆã£ã¦é£›ã¶ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰ãˆã‚‹ä¾‹ã§ã™
        const editLink = document.getElementById('github-edit-link');
        // editLink.href = `https://github.com/[ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å]/[ãƒªãƒã‚¸ãƒˆãƒªå]/blob/main/data/projects_${currentBot}.json`; 

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
        async function loadCategories() {
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–ã®ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸
                const response = await fetch(`data/categories_${currentBot}.json?t=${new Date().getTime()}`);
                
                if (response.ok) {
                    categories = await response.json();
                } else {
                    console.warn('ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                    categories = [
                        { id: 'GAS', name: 'GAS', color: '#34A853' },
                        { id: 'GitHub', name: 'GitHub', color: '#24292e' },
                        { id: 'Cloudflare', name: 'Cloudflare', color: '#F38020' },
                        { id: 'Genspark', name: 'Genspark', color: '#6366f1' },
                        { id: 'Vercel', name: 'Vercel', color: '#000000' },
                        { id: 'Other', name: 'ãã®ä»–', color: '#64748b' }
                    ];
                }
                renderFilterButtons();
            } catch (e) {
                console.error('ã‚«ãƒ†ã‚´ãƒªãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¡¨ç¤ºã—ã¦ç¶šè¡Œ
                categories = [
                        { id: 'Other', name: 'All', color: '#64748b' }
                ];
                renderFilterButtons();
            }
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã‚’æç”»
        function renderFilterButtons() {
            const filterSection = document.getElementById('filter-section');
            
            let buttons = '<button class="filter-btn active" data-filter="all">ã™ã¹ã¦</button>';
            categories.forEach(cat => {
                buttons += `<button class="filter-btn" data-filter="${cat.id}" style="--category-color: ${cat.color}">${cat.name}</button>`;
            });
            
            filterSection.innerHTML = buttons;
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®š
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const filter = btn.dataset.filter;
                    
                    if (filter === 'all') {
                        displayProjects(allProjects);
                    } else {
                        const filtered = allProjects.filter(p => p.platform === filter);
                        displayProjects(filtered);
                    }
                });
            });
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å–å¾—
        async function loadProjects() {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('projects-grid');
            const errorDiv = document.getElementById('error');

            try {
                // projects_yuzu.json ã¾ãŸã¯ projects_kedo.json ã‚’èª­ã¿è¾¼ã‚€
                const response = await fetch(`data/projects_${currentBot}.json?t=${new Date().getTime()}`);
                
                if (!response.ok) {
                    throw new Error(`ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«(projects_${currentBot}.json)ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚GitHubã®dataãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
                }

                allProjects = await response.json();
                
                loading.style.display = 'none';
                displayProjects(allProjects);
            } catch (error) {
                loading.style.display = 'none';
                errorDiv.innerHTML = `
                    <p>âŒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
                    <p class="error-detail">${error.message}</p>
                    <p class="error-hint">ç®¡ç†è€…ã®æ–¹ã¸: dataãƒ•ã‚©ãƒ«ãƒ€ã« projects_${currentBot}.json ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                `;
                errorDiv.style.display = 'block';
                console.error(error);
            }
        }

        // Google Driveç”»åƒURLã‚’å¤‰æ›
        function convertGoogleDriveUrl(url) {
            if (!url) return '';
            
            const driveMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                return `https://drive.google.com/thumbnail?id=${driveMatch[1]}&sz=w800`;
            }
            
            if (url.includes('drive.google.com/thumbnail')) {
                return url;
            }
            
            const idMatch = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
            if (idMatch) {
                return `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w800`;
            }
            
            return url;
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±ã‚’å–å¾—
        function getCategoryInfo(platformId) {
            const category = categories.find(c => c.id === platformId);
            return category || { id: 'Other', name: 'ãã®ä»–', color: '#64748b' };
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ç¤º
        function displayProjects(projects) {
            const grid = document.getElementById('projects-grid');
            
            if (!projects || projects.length === 0) {
                grid.innerHTML = '<div class="no-projects"><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p></div>';
                return;
            }

            grid.innerHTML = projects.map(project => {
                const thumbnailUrl = convertGoogleDriveUrl(project.thumbnail);
                const categoryInfo = getCategoryInfo(project.platform);
                
                return `
                <div class="project-card" data-platform="${project.platform || 'Other'}">
                    <div class="project-thumbnail">
                        ${thumbnailUrl 
                            ? `<img src="${thumbnailUrl}" alt="${project.title}" onerror="this.parentElement.innerHTML='<div class=\\'thumbnail-placeholder\\'>ğŸ“„</div>'">`
                            : `<div class="thumbnail-placeholder">ğŸ“„</div>`
                        }
                        <div class="thumbnail-overlay">
                            <span class="platform-badge" style="background-color: ${categoryInfo.color}">${categoryInfo.name}</span>
                        </div>
                    </div>
                    <div class="project-content">
                        <h3>${project.title}</h3>
                        <p class="project-description">${project.description || 'èª¬æ˜ãªã—'}</p>
                        ${project.tags ? `
                            <div class="project-tags">
                                ${project.tags.split(',').map(tag => 
                                    `<span class="tag">${tag.trim()}</span>`
                                ).join('')}
                            </div>
                        ` : ''}
                        <div class="project-links">
                            <a href="${project.url}" target="_blank" class="project-link project-link-view">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                                    <path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                                </svg>
                                <span>ã‚µã‚¤ãƒˆã‚’é–‹ã</span>
                            </a>
                            ${project.editUrl ? `
                                <a href="${project.editUrl}" target="_blank" class="project-link project-link-edit">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                                    </svg>
                                    <span>ç·¨é›†ç”»é¢</span>
                                </a>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        // ä¸¦åˆ—ã§èª­ã¿è¾¼ã‚€ã¨é€Ÿã„ã§ã™
        Promise.all([loadCategories(), loadProjects()]);
    </script>
</body>
</html>
